ordering: 2
prerequisiteGuideSlugs:
  - "ground-control-first-stack"
metadata:
  title: "Credentials, Not Secrets - AWS Integration"
  description: "Connect to AWS securely using cross-account role assumption instead of static credentials"
  labels: ["aws", "integration", "security", "iam", "cloud-credentials"]
  difficulty: "easy"
  minutesToComplete: 25
  prerequisites:
    - "You should have completed the 'Ground Control' guide and have a working stack"
    - "You need an AWS account with permissions to create IAM roles"
    - "Basic understanding of AWS IAM concepts is helpful but not required"

steps:
  - order: 1
    title: "Get Your Spacelift Account ID"
    instruction: |
      1. Navigate to [Integrate services > Integrations](/integrations).
      2. Look for the **AWS** tile and click **View**.
      3. Find your Spacelift AWS Account integration and open the integration actions dropdown on the right side of the table item.
      4. Click **Copy ID** â€” you'll need it to create the IAM role trust policy. It should look something like '324320755747'.
    hint: "This is Spacelift's AWS account ID that will assume roles in your AWS account. Every Spacelift account has a unique ID. Keep this handy - you'll paste it into AWS in the next step."
    validation: "User confirms they have copied their Spacelift AWS Account ID"

  - order: 2
    title: "Create IAM Role in AWS Console"
    instruction: |
      1. Log into your AWS Console and navigate to IAM > Roles > **Create role**.
      2. Select **AWS account** as trusted entity type.
      3. Choose **Another AWS account** and paste your Spacelift Account ID.
      4. Enable **Require external ID** and enter your Spacelift workspace name (found in your Spacelift URL).
      5. Click **Next**.
    hint: "The external ID adds an extra layer of security - it prevents the 'confused deputy' problem where someone else with access to the Spacelift account couldn't access your AWS resources. Use your workspace name as the external ID for simplicity."
    validation: "User confirms they have started creating the IAM role with correct trust policy"

  - order: 3
    title: "Attach Permissions to IAM Role"
    instruction: |
      1. On the permissions page, search for and attach the **PowerUserAccess** managed policy (or create a custom policy with specific permissions if you prefer minimal access). For this demo, PowerUserAccess is sufficient.
      2. Name your role 'spacelift-orbit-labs-role' or similar.
      3. Add description: 'Role for Spacelift to manage AWS infrastructure'.
      4. Click **Create role**.
    hint: "PowerUserAccess gives broad permissions except IAM user/role management - good for demos and learning. For production, use least-privilege policies specific to your infrastructure needs. Note your role ARN - you'll need it in Spacelift!"
    validation: "User confirms they have created the IAM role and copied the role ARN"

  - order: 4
    title: "Create AWS Integration in Spacelift"
    instruction: |
      1. Go to [Integrate services > Integrations](/integrations). Look for the **AWS** tile and click **View** and click **Set up integration**.
      2. Name it 'orbit-labs-aws'.
      3. Paste your IAM role ARN (from AWS) into the **Role ARN** field.
      4. The external ID should auto-populate with your workspace name.
      5. Enable both **Read** and **Write** access.
      6. Click **Create integration**.
    hint: "The integration doesn't store any credentials - it just stores the role ARN and external ID. When your stack runs, Spacelift will dynamically assume this role to get temporary credentials. This is much more secure than storing access keys!"
    validation: "AWS integration exists with role assumption configured"

  - order: 5
    title: "Update Your Terraform Code"
    instruction: |
      In your repository (orbit-labs-demo), edit main.tf to add AWS provider and a data source:
      ```language-terraform
      terraform {
        required_providers {
          aws = {
            source  = "hashicorp/aws"
            version = "~> 5.0"
          }
        }
      }

      provider "aws" {
        region = "us-east-1"
      }

      data "aws_caller_identity" "current" {}

      output "aws_account_id" {
        value = data.aws_caller_identity.current.account_id
      }
      ```
      Commit and push.
    hint: "The aws_caller_identity data source is perfect for testing - it just tells you who you are in AWS (your account ID). If this works, it means Spacelift successfully assumed your IAM role!"
    validation: "User confirms they have updated their Terraform code with AWS provider and caller identity"

  - order: 6
    title: "Attach Integration to Your Stack"
    instruction: |
      1. Navigate to your stack (orbit-labs-demo).
      2. Go to **Settings** > **Cloud integrations**.
      3. Click **Attach integration** and select your 'orbit-labs-aws' integration from the dropdown.
      4. Enable both **Read** and **Write** permissions for the integration.
      5. Click **Save**.
    hint: "Attaching the integration to the stack tells Spacelift to use these credentials when running this stack. You can attach different integrations to different stacks for separation of concerns."
    validation: "Integration is attached to stack"

  - order: 7
    title: "Trigger Run with AWS Integration"
    instruction: |
      1. In your stack, click **Trigger** and start a new tracked run with a note like 'Testing AWS integration'.
      2. Watch the run progress through initialization and planning.
      3. You should see Terraform initialize the AWS provider successfully.
      4. Review the plan - it should show no infrastructure changes but will query AWS.
    hint: "During the INITIALIZING phase, watch for logs showing 'Assuming role' - this confirms Spacelift is successfully assuming your IAM role. If you see authentication errors, double-check your role ARN and trust policy."
    validation: "Run is in progress or completed"

  - order: 8
    title: "Confirm Plan and Apply"
    instruction: |
      1. After planning completes, review the plan. Since we only added a data source (which just queries AWS) and kept the random_pet resource, you should see 0 changes but 1 resource to refresh (the data source).
      2. Click **Confirm** to apply.
      3. The run should complete quickly.
    hint: "Data sources don't create infrastructure - they just read information. This is perfect for testing credentials without actually creating any AWS resources (and avoiding any costs!)."
    validation: "User has confirmed the plan"

  - order: 9
    title: "Verify AWS Access in Outputs"
    instruction: |
      1. After the run finishes with FINISHED state, scroll to the **Outputs** section or click on the run details.
      2. You should see 'aws_account_id' output showing your AWS account ID.
      3. This confirms that Spacelift successfully assumed your IAM role and made an authenticated call to AWS!
    hint: "Success! You've just configured secure, temporary credential access to AWS. No access keys stored anywhere, no secrets to rotate - just secure role assumption. This is the foundation for all your AWS infrastructure management in Spacelift. Your AWS account ID in the output is proof that the integration works!"
    validation: "Run completed successfully with AWS caller identity in outputs"

  - order: 10
    title: "Understand What You Built"
    instruction: "Review what you've accomplished: You created an IAM role in AWS that trusts Spacelift, configured Spacelift to assume that role, and successfully made authenticated AWS API calls - all without storing any long-lived credentials. This is cloud security best practice in action."
    hint: "This pattern scales to production: different roles for different environments, least-privilege permissions, automatic credential rotation, and full audit trails. Orbit Labs is now ready to deploy real AWS infrastructure securely!"
    validation: "User confirms they understand the secure credential pattern"

completion:
  successMessage: "Excellent! You've configured secure AWS access using IAM role assumption - no static credentials needed. You now understand how Spacelift securely connects to cloud providers using temporary, rotating credentials."
  recommendedGuideIds: []
